---- 380kV Berlin 
--- line doesn't exist in entso-e, substations are 110kV in osm 
-- delete 380kV buses nd lines and temporary reconnect one-ports
DELETE FROM model_draft.ego_grid_pf_hv_busmap WHERE scn_name = 'Status Quo';

UPDATE model_draft.ego_grid_pf_hv_generator
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Biesdorf Nord' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Biesdorf Nord' AND base_kv = 380);

UPDATE model_draft.ego_grid_pf_hv_load
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Biesdorf Nord' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Biesdorf Nord' AND base_kv = 380);

UPDATE model_draft.ego_grid_pf_hv_storage
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Biesdorf Nord' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Biesdorf Nord' AND base_kv = 380);

UPDATE model_draft.ego_grid_pf_hv_load
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Lichtenberg' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Lichtenberg' AND base_kv = 380);

UPDATE model_draft.ego_grid_pf_hv_storage
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Lichtenberg' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE osm_name = 'Umspannwerk Lichtenberg' AND base_kv = 380);

DELETE FROM model_draft.ego_grid_pf_hv_bus WHERE v_nom = 380 AND bus_id IN (SELECT bus_i FROM grid.otg_ehvhv_bus_data
WHERE geom IN ('0101000020E6100000E6D4C59C60F02A40A254AE08CF424A40','0101000020E61000000F6844C4280B2B4074AC9C07C1424A40', '0101000020E61000008A5DDBDB2DE92A40372C5789C3424A40', '0101000020E6100000799F91F85E0B2B40277E8D4F25434A40', '0101000020E6100000ADA580B4FF112B40829EBC7E77434A40', '0101000020E6100000C8C54A64F5122B4012EB782DCC444A40')
AND base_kv = 380);

DELETE FROM model_draft.ego_grid_pf_hv_line WHERE bus0 IN (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom IN ('0101000020E6100000E6D4C59C60F02A40A254AE08CF424A40','0101000020E61000000F6844C4280B2B4074AC9C07C1424A40', '0101000020E61000008A5DDBDB2DE92A40372C5789C3424A40', '0101000020E6100000799F91F85E0B2B40277E8D4F25434A40', '0101000020E6100000ADA580B4FF112B40829EBC7E77434A40', '0101000020E6100000C8C54A64F5122B4012EB782DCC444A40')
AND base_kv = 380);

DELETE FROM model_draft.ego_grid_pf_hv_transformer WHERE bus1 IN (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom IN ('0101000020E6100000E6D4C59C60F02A40A254AE08CF424A40','0101000020E61000000F6844C4280B2B4074AC9C07C1424A40', '0101000020E61000008A5DDBDB2DE92A40372C5789C3424A40', '0101000020E6100000799F91F85E0B2B40277E8D4F25434A40', '0101000020E6100000ADA580B4FF112B40829EBC7E77434A40', '0101000020E6100000C8C54A64F5122B4012EB782DCC444A40')
AND base_kv = 380);


---- 220kV Weiher
--- missing line from Weiher to Uchtelfangen
-- add line
INSERT INTO model_draft.ego_grid_pf_hv_line (line_id, bus0, bus1, s_nom, cables, frequency, topo, geom, length, x)
SELECT	nextval('model_draft.ego_grid_hv_electrical_neighbours_line_id'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 220 AND osm_name = 'KW Weiher'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 220 AND osm_name = 'Umspannwerk Uchtelfangen'),
	1040,
	6,
	50,
	'0102000020E610000002000000D6DAC30771211C402D969AACD8AA4840650A175E64FC1B4071A44A690DB04840',
	'0105000020E610000001000000010200000002000000D6DAC30771211C402D969AACD8AA4840650A175E64FC1B4071A44A690DB04840',
	5.23167613642908 * 1.15,
	5.23167613642908 * 1.15 * 314.15 * 0.001/2;

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, s_nom, cables, frequency, topo, geom, length, x)
SELECT	'NEP 2035', line_id, bus0, bus1, s_nom, cables, frequency, topo, geom, length, x
FROM model_draft.ego_grid_pf_hv_line WHERE topo = '0102000020E610000002000000D6DAC30771211C402D969AACD8AA4840650A175E64FC1B4071A44A690DB04840' AND s_nom = 1040 AND scn_name = 'Status Quo';

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, s_nom, cables, frequency, topo, geom, length, x)
SELECT	'eGo 100', line_id, bus0, bus1, s_nom, cables, frequency, topo, geom, length, x
FROM model_draft.ego_grid_pf_hv_line WHERE topo = '0102000020E610000002000000D6DAC30771211C402D969AACD8AA4840650A175E64FC1B4071A44A690DB04840' AND s_nom = 1040 AND scn_name = 'Status Quo';

---- 220kV Industriepark Höchst
--- wrong voltage-level 
-- change v_nom from 220kV to 110kV, add/delete buses, change one-ports buses
UPDATE model_draft.ego_grid_pf_hv_generator
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 220);

UPDATE model_draft.ego_grid_pf_hv_generator
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 220);

UPDATE model_draft.ego_grid_pf_hv_load
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 220);

UPDATE model_draft.ego_grid_pf_hv_load
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 220);

UPDATE model_draft.ego_grid_pf_hv_storage
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 220);

UPDATE model_draft.ego_grid_pf_hv_storage
SET	bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 110)
WHERE bus = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 220);

INSERT INTO model_draft.ego_grid_pf_hv_bus (bus_id, v_nom, geom)
SELECT DISTINCT ON (geom)
	nextval('model_draft.ego_grid_hv_electrical_neighbours_bus_id'),
	110,
	geom
FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E61000008FEB3AAF0C152140B97D456DD1094940';

INSERT INTO model_draft.ego_grid_pf_hv_bus (scn_name, bus_id, v_nom, geom)
SELECT 'NEP 2035', bus_id, v_nom, geom
FROM model_draft.ego_grid_pf_hv_bus 
WHERE geom = '0101000020E61000008FEB3AAF0C152140B97D456DD1094940' AND v_nom = 110 AND scn_name = 'Status Quo';

INSERT INTO model_draft.ego_grid_pf_hv_bus (scn_name, bus_id, v_nom, geom)
SELECT 'eGo 100', bus_id, v_nom, geom
FROM model_draft.ego_grid_pf_hv_bus 
WHERE geom = '0101000020E61000008FEB3AAF0C152140B97D456DD1094940' AND v_nom = 110 AND scn_name = 'Status Quo';

UPDATE model_draft.ego_grid_pf_hv_line 
SET	bus1 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 110),
	bus0 = (SELECT bus_id FROM model_draft.ego_grid_pf_hv_bus WHERE geom = '0101000020E61000008FEB3AAF0C152140B97D456DD1094940' AND v_nom = 110),
	s_nom = 520,
	cables = 6,
	x = length * 314.15 * 0.0012/2
WHERE bus1 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E610000091281516C01521401894D558490C4940' AND base_kv = 220)
	AND bus0 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E61000008FEB3AAF0C152140B97D456DD1094940' AND base_kv = 220);

UPDATE model_draft.ego_grid_pf_hv_line 
SET	bus0 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 110),
	bus1 = (SELECT bus_id FROM model_draft.ego_grid_pf_hv_bus WHERE geom = '0101000020E61000008FEB3AAF0C152140B97D456DD1094940' AND v_nom = 110),
	s_nom = 520,
	cables = 6,
	x = length * 314.15 * 0.0012/2
WHERE bus0 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E6100000C208F2600E1321404EED06B1FE094940' AND base_kv = 220)
	AND bus1 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom = '0101000020E61000008FEB3AAF0C152140B97D456DD1094940' AND base_kv = 220);

DELETE FROM model_draft.ego_grid_pf_hv_bus WHERE bus_id IN 
(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE geom IN ('0101000020E61000008FEB3AAF0C152140B97D456DD1094940', '0101000020E6100000C208F2600E1321404EED06B1FE094940', '0101000020E610000091281516C01521401894D558490C4940') AND base_kv = 220);

---220kV subnetwork Heinitz/Saarstahl
--- add 220kV line from Uchtelfangen to Heinitz, in respect to osm and bing
-- this error is maybe fixed in osm 
INSERT INTO model_draft.ego_grid_pf_hv_line (line_id, bus0, bus1, length, topo, geom,  x, r, s_nom, cables, frequency)
SELECT 	nextval('model_draft.ego_grid_hv_electrical_neighbours_line_id'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 220 AND osm_name = 'Umspannwerk Uchtelfangen'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 220 AND osm_name = 'Umspannwerk Heinitz'),
	10.6040557238013, 
	'0102000020E610000002000000650A175E64FC1B4071A44A690DB0484085E1E2CCE9771C40D1DD7BCF2EA94840',
	'0105000020E610000001000000010200000002000000650A175E64FC1B4071A44A690DB0484085E1E2CCE9771C40D1DD7BCF2EA94840',
	10.6040557238013 * 314 * 0.001/2,
	10.6040557238013 * 0.109/2,
	1040,
	6,
	50;

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, length, topo, geom,  x, r, s_nom, cables, frequency)
SELECT 'NEP 2035', line_id, bus0, bus1, length, topo, geom,  x, r, s_nom, cables, frequency
FROM model_draft.ego_grid_pf_hv_line
WHERE scn_name = 'Status Quo' AND s_nom = 1040 AND topo = '0102000020E610000002000000650A175E64FC1B4071A44A690DB0484085E1E2CCE9771C40D1DD7BCF2EA94840';

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, length, topo, geom,  x, r, s_nom, cables, frequency)
SELECT 'eGo 100', line_id, bus0, bus1, length, topo, geom,  x, r, s_nom, cables, frequency
FROM model_draft.ego_grid_pf_hv_line
WHERE scn_name = 'Status Quo' AND s_nom = 1040 AND topo = '0102000020E610000002000000650A175E64FC1B4071A44A690DB0484085E1E2CCE9771C40D1DD7BCF2EA94840';
	
---- Verbindung Lübeck-Siems
INSERT INTO model_draft.ego_grid_pf_hv_bus (bus_id, v_nom, geom)
SELECT DISTINCT ON (geom)
	nextval('model_draft.ego_grid_hv_electrical_neighbours_bus_id'),
	220,
	geom
FROM grid.otg_ehvhv_bus_data WHERE osm_name IN ('Umspannwerk Siems');

INSERT INTO model_draft.ego_grid_pf_hv_bus (scn_name, bus_id, v_nom, geom)
SELECT 'NEP 2035', bus_id, v_nom, geom
FROM model_draft.ego_grid_pf_hv_bus 
WHERE scn_name = 'Status Quo' AND geom = '0101000020E6100000D38040358C8525403935408972F44A40' AND v_nom = 220;

INSERT INTO model_draft.ego_grid_pf_hv_bus (scn_name, bus_id, v_nom, geom)
SELECT 'eGo 100', bus_id, v_nom, geom
FROM model_draft.ego_grid_pf_hv_bus
WHERE scn_name = 'Status Quo' AND geom = '0101000020E6100000D38040358C8525403935408972F44A40' AND v_nom = 220;
	
INSERT INTO model_draft.ego_grid_pf_hv_line (line_id, bus0, bus1, s_nom, topo, geom, length, x, cables, frequency)
SELECT	nextval('model_draft.ego_grid_hv_electrical_neighbours_line_id'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 220 AND osm_name = 'Lübeck'),
	(SELECT DISTINCT ON (bus_id) bus_id FROM model_draft.ego_grid_pf_hv_bus WHERE v_nom = 220 AND geom = '0101000020E6100000D38040358C8525403935408972F44A40'),
	520,
	'0102000020E6100000020000006380D3776E4825406764811FA7F54A40D38040358C8525403935408972F44A40',
	'0105000020E6100000010000000102000000020000006380D3776E4825406764811FA7F54A40D38040358C8525403935408972F44A40',
	7.91338283450564 * 1.15,
	314.15 * 0.001 * 7.91338283450564 * 1.15,
	3,
	50;

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, s_nom, topo, geom, length, x, cables, frequency)
SELECT 'NEP 2035', line_id, bus0, bus1, s_nom, topo, geom, length, x, cables, frequency
FROM model_draft.ego_grid_pf_hv_line 
WHERE scn_name = 'Status Quo' AND geom = '0105000020E6100000010000000102000000020000006380D3776E4825406764811FA7F54A40D38040358C8525403935408972F44A40' AND s_nom = 520;

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, s_nom, topo, geom, length, x, cables, frequency)
SELECT 'eGo 100', line_id, bus0, bus1, s_nom, topo, geom, length, x, cables, frequency
FROM model_draft.ego_grid_pf_hv_line 
WHERE scn_name = 'Status Quo' AND geom = '0105000020E6100000010000000102000000020000006380D3776E4825406764811FA7F54A40D38040358C8525403935408972F44A40' AND s_nom = 520;
	
INSERT INTO model_draft.ego_grid_pf_hv_transformer(trafo_id, bus0, bus1, s_nom, x, phase_shift, tap_ratio, topo, geom)
SELECT 	nextval('model_draft.ego_grid_hv_electrical_neighbours_transformer_id'),
	(SELECT DISTINCT ON (bus_id) bus_id FROM model_draft.ego_grid_pf_hv_bus WHERE v_nom = 220 AND geom = '0101000020E6100000D38040358C8525403935408972F44A40'),
	(SELECT DISTINCT ON (bus_id) bus_id FROM model_draft.ego_grid_pf_hv_bus WHERE v_nom = 380 AND geom = '0101000020E6100000D38040358C8525403935408972F44A40'),
	600,
	9.68,
	0,
	1,
	'0102000020E610000002000000D38040358C8525403935408972F44A40D38040358C8525403935408972F44A40',
	'0105000020E610000001000000010200000002000000D38040358C8525403935408972F44A40D38040358C8525403935408972F44A40';

INSERT INTO model_draft.ego_grid_pf_hv_transformer(scn_name, trafo_id, bus0, bus1, s_nom, x, phase_shift, tap_ratio, topo, geom)
SELECT 'NEP 2035', trafo_id, bus0, bus1, s_nom, x, phase_shift, tap_ratio, topo, geom
FROM model_draft.ego_grid_pf_hv_transformer 
WHERE scn_name = 'Status Quo' AND geom = '0105000020E610000001000000010200000002000000D38040358C8525403935408972F44A40D38040358C8525403935408972F44A40' AND s_nom = 600;

INSERT INTO model_draft.ego_grid_pf_hv_transformer(scn_name, trafo_id, bus0, bus1, s_nom, x, phase_shift, tap_ratio, topo, geom)
SELECT 'eGo 100', trafo_id, bus0, bus1, s_nom, x, phase_shift, tap_ratio, topo, geom
FROM model_draft.ego_grid_pf_hv_transformer 
WHERE scn_name = 'Status Quo' AND geom = '0105000020E610000001000000010200000002000000D38040358C8525403935408972F44A40D38040358C8525403935408972F44A40' AND s_nom = 600;

---- 380kV Plattling 
--- wrong line connection 
-- delete old line and add new one
INSERT INTO model_draft.ego_grid_pf_hv_bus (bus_id, v_nom, geom)
VALUES	(nextval('model_draft.ego_grid_hv_electrical_neighbours_bus_id'),
	380,
	'0101000020E6100000E1F4899702B52940FA1DD48F97614840');
	
INSERT INTO model_draft.ego_grid_pf_hv_bus (scn_name, bus_id, v_nom, geom)
SELECT 'NEP 2035', bus_id, v_nom, geom
FROM model_draft.ego_grid_pf_hv_bus
WHERE scn_name = 'Status Quo' AND geom = '0101000020E6100000E1F4899702B52940FA1DD48F97614840' AND v_nom = 380;

INSERT INTO model_draft.ego_grid_pf_hv_bus (scn_name, bus_id, v_nom, geom)
SELECT 'eGo 100', bus_id, v_nom, geom
FROM model_draft.ego_grid_pf_hv_bus
WHERE scn_name = 'Status Quo' AND geom = '0101000020E6100000E1F4899702B52940FA1DD48F97614840' AND v_nom = 380;

INSERT INTO model_draft.ego_grid_pf_hv_line (line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency)
VALUES (nextval('model_draft.ego_grid_hv_electrical_neighbours_line_id'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 380 AND osm_name = 'Umspannwerk Pleinting'),
	(SELECT DISTINCT ON (bus_id) bus_id FROM  model_draft.ego_grid_pf_hv_bus WHERE v_nom = 380 AND geom = '0101000020E6100000E1F4899702B52940FA1DD48F97614840'),
	'0102000020E61000000200000030AC43C5F4342A40D8CA9DE357554840E1F4899702B52940FA1DD48F97614840',
	'0105000020E610000001000000010200000032000000E1F4899702B52940FA1DD48F976148401D2C5217DFB629402B5327FB42614840CAF6C6B546B92940DE03745FCE604840DF1C098F91BB29403F41182E6160484075EF9705C9BD2940154152FAF85F4840EA91ABFD42C02940C81FB182845F484054AE4BE889C22940171A3ED8185F4840D5592DB0C7C4294041F0F8F6AE5E4840A65B1BCF0CC729409679ABAE435E4840AD6D8AC745C9294031395A7AD95D48402CADD05158CB2940D4827236785D48403535BF5076CD29402B3BB313145D484044F174F8B5CF2940EA5A7B9FAA5C4840EB3E5B62C0D12940B0D69AF7495C4840C30A5CC3B1D329400371C394ED5B4840A16BBAF9A1D52940C65E398C935B4840178F41DDF6D729404C112A82495B4840E58E482586DA2940F855B950F95A484042823D810BDD294038FEFAD7A85A48404CA59F7076DF2940E27899BC5C5A4840650CBD0F51E22940E256E652015A4840203FC0FFFBE42940B3B112F3AC594840C5CC9948C4E72940B6CA5D9555594840896A0025F4E929406304F97E0F59484025F4E967A0EC2940D07F0F5EBB58484035046CAC69EF2940CD1DA2766458484012A5BDC117F22940E6B4029E0F5848403CF4DDAD2CF5294024AF7378AD5748400E9D43BEF0F7294044937A05585748405820D50B99FA2940FE63213A04574840996AC1E677FD294020D099B4A956484063EA533310002A40BB39A63858564840B3CF639467022A40CFC023850D5648400848EAF307052A40A297512CB7554840AB871EE7EC072A4089FF852F5D554840A3135333B50A2A40BC2CDCA8045548403EE2FCF26E0D2A40ACA0B316B0544840A5486359D50F2A40E729615C6054484003931B45D6122A40351D4B6947544840C878944A78162A40CEEE7F3628544840F11879B4CC192A402321DB430C544840416150A6D11C2A40B35F77BAF3534840C1ADBB79AA1F2A403D57A53EDA534840F9307BD976222A404969368FC3534840032BE2CF4B242A4031E076B2E553484071766B990C272A4040C1C58A1A5448404301DBC188292A4063DD2EEA49544840C19206126F2C2A40058651B58254484048B599547E2F2A40ED22F197BB5448406B6A3414D2312A40006A0F20E8544840', 
	22.624793411008,
	314.15 * 0.0008 * 22.624793411008,
	1790,
	3,
	50),

	(nextval('model_draft.ego_grid_hv_electrical_neighbours_line_id'),
	(SELECT DISTINCT ON (bus_id) bus_id FROM  model_draft.ego_grid_pf_hv_bus WHERE v_nom = 380 AND geom = '0101000020E6100000E1F4899702B52940FA1DD48F97614840'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 380 AND osm_name = 'Schwandorf'),
	'0102000020E610000002000000E1F4899702B52940FA1DD48F97614840BBEF0B431D2A2840230697C412A64840',
	'0105000020E610000003000000010200000006000000C0EF0B431D2A2840200697C412A64840B2C68FE7E92A2840E88E5951DEA5484060668E9BD02A2840C4149B45DEA5484026FC523F6F2A2840352CA116DEA5484071A4D8767F292840C0EAC891CEA548400A2DEBFEB1282840BCEBC781B2A548400102000000040000006B6A3414D2312A40006A0F20E85448405AFBF14D89322A40263218C8585548407AD10D034C332A40B566D0758655484044AC43C5F4342A40D9CA9DE3575548400102000000CE0000000A2DEBFEB1282840BCEBC781B2A5484067E77E98CE2828402497FF907EA54840D026874F3A292840823D810B0DA548408ED7721D99292840688297CFA8A4484084DCA051152A28403430F2B226A44840BFDD488F952A2840FDAEBE709DA348402B4F20EC142B2840CA260A3E17A34840C2590009792B2840E8065449AEA24840FC45BF6CF12B2840A19FA9D72DA24840031203136E2C28408CA03193A8A148402E07D561E02C2840A60EF27A30A14840E801E264D12E28407B88467710A1484060A7FD7B9531284063145F48E2A0484059880E81233528408CE8E802A8A048400475CAA31B392840847F113466A04840B47B4D6AC33C2840A3B1513129A04840683EE76ED73F2840F85BF1C3F79F484047489341A4412840C4E347A1D19F4840468E194DD3442840ECEA9FF18E9F4840C48FD6BDBA4728403E0F49884D9F4840D09D60FF754A2840319CC651149F4840558440D3B74D28400E2840B9129F4840D604ACB074512840F2BEE0890F9F4840BA7C355195542840CF4A5AF10D9F48406ADF3719B0572840EF5B08CD099F4840238216B7765B2840906D7429099F4840B05CCA541C5E28405E448078029F4840EFEC86C844612840F08398F0F09E4840A88A4E3BA164284039C3C36AE29E4840EDF1423A3C682840C49B9031D29E4840329FBD44066B28403CE3569CC59E484089A8D3CB396E2840C7BB2363B59E4840F10D85CFD6712840E1687D80A49E4840A125D9340075284015D4A6A0919E4840C86EB081BE76284032DD90EB4B9E484061F998B44E792840FDEC9117E39D48404F01D5E4CE792840768071BA769D484050768E5C927A28400DD30847DA9C4840E158BCFD5E7B284079D388F4369C4840F1F62004E47B284049BA66F2CD9B4840FADB5493967C284003CC7C073F9B484093F139C1487D284082F3F3F0AF9A4840AB6FAAFFBD7D28401222CFE4519A4840F17F4754A87E284001E77BFC94994840BC410F10277F284058B9612530994840291B7B9BA37F2840A4816962CB984840C5DF9B4B168028403128D36872984840F8F829334A8028406D09545ADA974840943AB7BF698028409C29BEEB7D974840667EDA4D95802840191AF44AFE964840B5F6E39B12812840AD78D965AE9648406242716CE2812840E55828E32996484035AB88E4758228400947DAD7CB95484079A235502A832840BBF1EEC858954840612129D8358428401258EF26AE9448409816F549EE842840E30D7A8038944840B00FFCB9B285284094957032BB93484062597A7E62862840748A9F104B934840EB45A3F1FA862840415365CEE99248406D4ECA49CD872840870B8A308F924840AD9E3825C588284045C9F50027924840E28A30EAFF8928400C923EADA29148406B4EB91D758B2840FD5DE9C6059148402E85515AC98C2840B741EDB7769048406166440EB68D284008AD872F13904840C5F13279B98E284004DD0319A68F48400AF31E679A902840C60B337E2B8F4840EC8E20F01B92284046990D32C98E48402AE9BC21E8932840E72620DC538E48407DEC8909C5952840FB952941DA8D4840A5468DAE7798284021E3F6706E8D4840E7954627A69A284089658E40178D4840A8A55E5C4F9D284066B8A6E5AC8C4840EE26F8A6E99F284078A27FDD448C48406C15B3147FA2284015A930B6108C4840D4884FF003A6284003A4479DCA8B4840361488E821A82840A32F73709F8B4840F743C769E3AB2840A00491A0538B4840EE00F4A045AF2840A5C5747C0F8B4840FFB7EDD68DB22840DE93E23ECD8A48407111291774B428403F092241A78A48402480F67EFEB62840A60A4625758A4840B032BF3F4AB9284052D4997B488A4840F6C2537E08BC28407EC34483148A48403636E0980ABE2840BC067DE9ED894840E785E05DD3C02840C54D57C1B9894840C5DC5ACB09C32840FEB1B5638F89484009A469F57AC42840082F0B372A894840589643E625C62840BB0D6ABFB5884840EA2DD45059C72840BC2EB2536288484005FE4BAD52C928407A05FDE0D78748404584DACAA6CB284032E5435035874840A2A476757DCD284056ECD401B5864840D51CC5DE30CE28408C0EED084C864840DA9486753ECF284099017855B18548404E97C5C4E6CF2840E7E4A0DF52854840D5BF35C181D228407978CF81E584484031653B3A09D428409A5A5B1DA584484031074147ABD6284020A8644A3584484047F9EEFBDCD92840AD0210D2AE8348409E06B1D8CBDB284012B57E445D8348406F5287CBE0DE2840848DA152DB8248405CCCCF0D4DE128407D5D86FF748248401FBDE13E72E3284051B0B5AD1C824840A96E89B729E52840EE485057D28148403242D36DE4E5284071CEE38B51814840F63988E7B6E628409B3347FBC48048404E42E90B21E72840A74709B07E80484012BC218D0AE828407BCCF6D7E17F48407480BB4791E828406056CD188B7F48407E4056A64EEA2840E94DA0E3FE7E484026DEA6E441EB2840932A9B83B17E48401C768478C9EC2840DA38622D3E7E4840116C01463CEE28406ECACB50CB7D4840175F590E99EF2840B24AE9995E7D4840DDCEBEF220F12840484A1F5FE77C48402CA0AB0892F22840F992D794757C48408C7D6E0D11F428408F78680EFF7B48408C88BDAB79F5284087DD770C8F7B484078E62F3E16F8284015B3B9C5577B48404076CD9A0EFB2840DBCD42F1197B484051BF0B5BB3FD284074DB74BAE27A48402F675B7281002940D4DC651AA87A48402DCDAD105603294069DDABFB6C7A4840C5758C2B2E06294058B329B2317A4840DDCAB7E3F2082940F25602CEF7794840FF31BE79BB0B294093A3A597BD79484073CAEDA87B0E294028B85851837948403CB02D4D5B11294083D4377A4679484065FF3C0D18142940FF44C07C0D794840BF72CE99FE1629406B28B517D17848400D0055DCB81929408934E0E297784840D96212899D1C29407E4397265B7848405B1A097E651F29403DD7F7E12078484051943AB7BF21294030C912E7F2774840C63945A22B242940794F2F42C27748406412E456F7262940E895FC998B77484063FDB0EFD4292940830BC3915177484049A2F20A9F2C2940DAF51CA21B774840F0976082642F294002767F06E57648407E384888F2312940C985144DB1764840FFBC5FBB6A342940B8509E1E80764840CC71B8A00837294003E32A604C76484085ABA8667B392940A49AA3D81B764840E443F57B073C2940ACAD3319E975484073F0F1AE1F3F29403D6D437BAB75484049A93A9AD9412940C4094CA7757548401F42A6C695442940B6D210FA3E754840F50AB034954629407728AF3A17754840737A83D49247294012BCC6D397744840F1CD80C4C0482940FB90B75CFD734840967DB2BD714929407D19D69EA37348406ADFDC5F3D4A2940E87CC2233B734840C4BC7D0C0C4B294028CB5A54D5724840E2033BFE0B4C2940337678BE557248406027501FDC4C2940DCA799A4E87148400EEDAD92D94E2940E3E13D07967148404FC9DEF714512940FA0159993A71484017B1F4465253294070445266DE704840102A2790C855294063B323D577704840C1D6B672405829404A2C84301270484061F1E54F655A29403C50A73CBA6F48400245D1A8655C2940FB0B981B676F4840ED24C742195F2940C967C3ABF66E484094BF7B478D6129407937BB5A936E4840ED35F39A0D6429407F29A84D416E4840C2F1214D61662940C3D89D49F66D4840F51E1D0D966829405389FC44AF6D4840823D810B0D6B29405270C2CE5E6D48404F53701D886D2940BDD930540F6D484070F32103D46F2940C4ACBC89C66C4840B1F4465277722940A9C0C936706C484032D6EDA29E74294085AC133C2A6C484052071E842577294044EC0214D96B4840386A85E97B79294005A96FF48C6B4840089E31827C7B2940C7CA79104C6B4840B7B82121257D2940A20337F7FC6A48403B8BDEA9807F2940A708CB338A6A4840C3E4FC039B81294029EACC3D246A48400EA320787C83294058665B17C8694840BB5A931392852940C77A0F3C636948405E6CB5E2768729409D2166400769484042621635F3872940FB35FEE9AB6848402F23AB11B0882940074E6CF420684840FABDA83869892940F9CFE4AC99674840DD32969F0A8A294011F0B5B123674840E1777874C88A29402614C7269E6648408DD5E6FF558B294007FE0120386648402FCAC749BC8B2940EC00E374ED65484076662728EA8D2940126C5CFFAE6548402CEADD697C9029406C996780666548408901B7932D932940F8CC48731A654840197DBBDBAB95294058CBF852D3644840C2572A5E1B9829408ECEF9298E6448406241ABDDC09A29406EBEB62341644840D988168F419D2940EB1791CDFA634840D8ED5811DA9F29407C5E961BB16348400BF7802F3BA22940154FE2186E634840429A0C22ADA42940EA1560692A6348408C45782057A7294030A3B327DC6248400FB16609D7A82940B18BFDC0B062484025523F1471AB2940A8DF2AF466624840B00A2F1C63AE294037177FDB136248405E471CB281B02940C72C7B12D8614840309DD66D50B3294082D94EA5B0614840E1F4899702B52940FA1DD48F97614840',
	90.5604456325126,
	314.15 * 0.0008 * 90.5604456325126,
	1790,
	3,
	50),

	(nextval('model_draft.ego_grid_hv_electrical_neighbours_line_id'),
	(SELECT DISTINCT ON (bus_id) bus_id FROM  model_draft.ego_grid_pf_hv_bus WHERE v_nom = 380 AND geom = '0101000020E6100000E1F4899702B52940FA1DD48F97614840'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 380 AND geom = '0101000020E6100000C000DCEF17B429409E0779BEB3614840'),
	'0102000020E610000002000000E1F4899702B52940FA1DD48F97614840C000DCEF17B429409E0779BEB3614840',
	'0105000020E610000001000000010200000002000000E1F4899702B52940FA1DD48F97614840C000DCEF17B429409E0779BEB3614840'
	0.162698660268822,
	314.15 * 0.0008 * 0.162698660268822,
	1790,
	3,
	50);

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency)
SELECT 'NEP 2035', line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency
FROM model_draft.ego_grid_pf_hv_line
WHERE scn_name = 'Status Quo' AND topo IN ('0102000020E61000000200000030AC43C5F4342A40D8CA9DE357554840E1F4899702B52940FA1DD48F97614840','0102000020E610000002000000E1F4899702B52940FA1DD48F97614840BBEF0B431D2A2840230697C412A64840','0102000020E610000002000000E1F4899702B52940FA1DD48F97614840C000DCEF17B429409E0779BEB3614840') AND s_nom = 1790; 

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency)
SELECT 'eGo 100', line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency
FROM model_draft.ego_grid_pf_hv_line
WHERE scn_name = 'Status Quo' AND topo IN ('0102000020E61000000200000030AC43C5F4342A40D8CA9DE357554840E1F4899702B52940FA1DD48F97614840','0102000020E610000002000000E1F4899702B52940FA1DD48F97614840BBEF0B431D2A2840230697C412A64840','0102000020E610000002000000E1F4899702B52940FA1DD48F97614840C000DCEF17B429409E0779BEB3614840') AND s_nom = 1790; 

DELETE FROM model_draft.ego_grid_pf_hv_line WHERE bus0 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 380 AND osm_name = 'Umspannwerk Pleinting') AND bus1 = (SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 380 AND osm_name = 'Schwandorf');

DELETE FROM model_draft.ego_grid_pf_hv_transformer WHERE bus1 = (SELECT DISTINCT ON (bus_i) bus_i FROM  grid.otg_ehvhv_bus_data WHERE base_kv = 380AND geom = '0101000020E61000002F70D819E6B4294094DDFA53EE614840');
	
DELETE FROM model_draft.ego_grid_pf_hv_bus WHERE geom = '0101000020E61000002F70D819E6B4294094DDFA53EE614840' AND v_nom = 380;

---- 380kV Weisweiler
--- missing connection from powerstation to 380kV line
-- add 380kV line
INSERT INTO model_draft.ego_grid_pf_hv_line (line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency)
SELECT 	nextval('model_draft.ego_grid_hv_electrical_neighbours_line_id'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 380 AND geom = '0101000020E610000050D9BE3268491940C27D4210236B4940'),
	(SELECT bus_i FROM grid.otg_ehvhv_bus_data WHERE base_kv = 380 AND geom = '0101000020E6100000FE4C1828844919408E469968EB6A4940'),
	'0102000020E61000000200000050D9BE3268491940C27D4210236B4940FE4C1828844919408E469968EB6A4940',
	'0105000020E61000000100000001020000000200000050D9BE3268491940C27D4210236B4940FE4C1828844919408E469968EB6A4940',
	0.189094013858938 * 1.15,
	314.15 * 0.0008 /2 *0.189094013858938 * 1.15,
	3580,
	6,
	50;
	
INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency)
SELECT 'NEP 2035', line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency
FROM model_draft.ego_grid_pf_hv_line
WHERE scn_name = 'Status Quo' AND topo = '0102000020E61000000200000050D9BE3268491940C27D4210236B4940FE4C1828844919408E469968EB6A4940' AND s_nom = 3580;

INSERT INTO model_draft.ego_grid_pf_hv_line (scn_name, line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency)
SELECT 'eGo 100', line_id, bus0, bus1, topo, geom,length,  x,  s_nom, cables, frequency
FROM model_draft.ego_grid_pf_hv_line
WHERE scn_name = 'Status Quo' AND topo = '0102000020E61000000200000050D9BE3268491940C27D4210236B4940FE4C1828844919408E469968EB6A4940' AND s_nom = 3580;



DELETE FROM model_draft.ego_grid_pf_hv_transformer WHERE bus1 NOT IN (SELECT bus_id FROM model_draft.ego_grid_pf_hv_bus) OR bus0 NOT IN (SELECT bus_id FROM model_draft.ego_grid_pf_hv_bus);